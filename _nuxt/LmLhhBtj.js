import{e as N,G as S,q as l,g as V,u as M,c as u,o as a,a as t,b as g,j as h,t as p,w as y,d as v,_ as j,i as w,s as B,x as _,y as U,J as q,A as z,l as C}from"#entry";import{_ as k}from"./Co_tMxFC.js";const G={class:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8"},I={class:"sm:mx-auto sm:w-full sm:max-w-md"},$={class:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10"},D={class:"text-center"},F={key:0,class:"space-y-4"},P={key:1,class:"space-y-4"},T={class:"mt-2 text-gray-600"},H={class:"mt-6"},L={key:2,class:"space-y-6"},R={key:0,class:"bg-red-50 border border-red-200 rounded-md p-4"},Z={class:"flex"},J={class:"ml-3"},O={class:"mt-2 text-sm text-red-700"},W={class:"text-left"},K=["disabled"],Q=["disabled"],X={class:"flex items-center space-x-3"},Y=["disabled"],oe=N({__name:"unsubscribe",setup(ee){const x=S(),i=l(""),c=l(""),r=l(!1),m=l(!1),f=l(!1),d=l(""),b=l(""),A=async()=>{const s=x.query.token,e=x.query.email;if(!(!s&&!e)){m.value=!0;try{const o=new URLSearchParams;s&&o.set("token",s),e&&o.set("email",e);const n=await $fetch(`/functions/v1/email-unsubscribe?${o}`);if(n.success)f.value=!0,b.value=n.message||"Sie wurden erfolgreich abgemeldet.";else throw new Error(n.error||"Abmeldung fehlgeschlagen")}catch(o){d.value=o instanceof Error?o.message:"Ein Fehler ist aufgetreten"}finally{m.value=!1}}},E=async()=>{if(!(!i.value||r.value)){r.value=!0,d.value="";try{const s=await $fetch("/functions/v1/email-unsubscribe",{method:"POST",body:{email:i.value,reason:c.value||void 0}});if(s.success)f.value=!0,b.value=s.message||"Sie wurden erfolgreich abgemeldet.";else throw new Error(s.error||"Abmeldung fehlgeschlagen")}catch(s){d.value=s instanceof Error?s.message:"Ein Fehler ist aufgetreten"}finally{r.value=!1}}};return V(()=>{A()}),M({title:"Newsletter abmelden",meta:[{name:"description",content:"Vom Newsletter abmelden - einfach und schnell"},{name:"robots",content:"noindex, nofollow"}]}),(s,e)=>{const o=j;return a(),u("div",G,[t("div",I,[t("div",$,[t("div",D,[e[13]||(e[13]=t("h2",{class:"text-2xl font-bold text-gray-900 mb-6"}," Newsletter abmelden ",-1)),m.value?(a(),u("div",F,[g(h(k),{class:"mx-auto"}),e[2]||(e[2]=t("p",{class:"text-gray-600"}," Ihre Abmeldung wird verarbeitet... ",-1))])):f.value?(a(),u("div",P,[e[5]||(e[5]=t("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100"},[t("svg",{class:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"})])],-1)),t("div",null,[e[3]||(e[3]=t("h3",{class:"text-lg font-medium text-gray-900"}," Erfolgreich abgemeldet ",-1)),t("p",T,p(b.value),1)]),t("div",H,[g(o,{to:"/",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},{default:y(()=>[...e[4]||(e[4]=[v(" Zur Startseite ",-1)])]),_:1})])])):(a(),u("div",L,[d.value?(a(),u("div",R,[t("div",Z,[t("div",J,[e[6]||(e[6]=t("h3",{class:"text-sm font-medium text-red-800"}," Fehler ",-1)),t("div",O,p(d.value),1)])])])):w("",!0),t("div",W,[e[11]||(e[11]=t("p",{class:"text-gray-600 mb-4"}," Es tut uns leid, dass Sie unseren Newsletter nicht mehr erhalten möchten. Geben Sie Ihre E-Mail-Adresse ein, um sich abzumelden. ",-1)),t("form",{onSubmit:B(E,["prevent"]),class:"space-y-4"},[t("div",null,[e[7]||(e[7]=t("label",{for:"email",class:"block text-sm font-medium text-gray-700"}," E-Mail-Adresse ",-1)),_(t("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=n=>i.value=n),type:"email",required:"",disabled:r.value,class:"mt-1 appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm disabled:opacity-50",placeholder:"ihre@email.de"},null,8,K),[[U,i.value]])]),t("div",null,[e[9]||(e[9]=t("label",{for:"reason",class:"block text-sm font-medium text-gray-700"}," Grund für die Abmeldung (optional) ",-1)),_(t("select",{id:"reason","onUpdate:modelValue":e[1]||(e[1]=n=>c.value=n),disabled:r.value,class:"mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm disabled:opacity-50"},[...e[8]||(e[8]=[z('<option value="">Bitte wählen...</option><option value="too_many_emails">Zu viele E-Mails</option><option value="not_relevant">Nicht relevant für mich</option><option value="never_signed_up">Habe mich nie angemeldet</option><option value="temporary">Vorübergehend pausieren</option><option value="other">Anderer Grund</option>',6)])],8,Q),[[q,c.value]])]),t("div",X,[t("button",{type:"submit",disabled:!i.value||r.value,class:"flex-1 group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed"},[r.value?(a(),C(h(k),{key:0,class:"w-4 h-4 mr-2"})):w("",!0),v(" "+p(r.value?"Wird verarbeitet...":"Abmelden"),1)],8,Y),g(o,{to:"/",class:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},{default:y(()=>[...e[10]||(e[10]=[v(" Abbrechen ",-1)])]),_:1})])],32)]),e[12]||(e[12]=t("div",{class:"border-t border-gray-200 pt-6"},[t("div",{class:"text-xs text-gray-500 space-y-2"},[t("p",null," Datenschutz: Ihre E-Mail-Adresse wird nur zur Verarbeitung Ihrer Abmeldung verwendet. "),t("p",null," Sie können sich jederzeit wieder für unseren Newsletter anmelden. ")])],-1))]))])])])])}}});export{oe as default};
